<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>APIGateway设计文档</title>
	
	
	<link rel="stylesheet" href="/css/style.css">
	
	
</head>
<body>
	<header>
	=================<br>
	== <a href="http://cxis.me/">Time Stream</a> ==<br>
	=================
	<div style="float: right;">一个小学生</div><br>
	<p>
	<nav>
			<a href="/"><b>Start</b></a>.
			
			
			<a href="/posts/"><b>Posts</b></a>.
			
			<a href="/categories"><b>Categories</b></a>.
			
			<a href="/tags"><b>Tags</b></a>.
			
	</nav>
	</p>
	
</header>

	
	<main>
		<article>
			<h1>APIGateway设计文档</h1>
			<b><time>2020-04-07 23:49:05</time></b>
		       
		           <a href="/tags/apigateway">APIGateway</a>
        	       

			<div>
				<p>APIGateway的设计文档，包括整体架构和数据库设计。</p>
<h1 id="整体架构">整体架构</h1>
<p>使用draw io画的图，这里是源文件：<a href="/APIGateway%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/APIGateway%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84.drawio">APIGateway整体架构</a></p>
<p>
<figure>
  <img src="/APIGateway%e8%ae%be%e8%ae%a1%e6%96%87%e6%a1%a3/APIGateway%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84.png" alt="APIGateway整体架构" />
</figure>


</p>
<ul>
<li>调用方，手机端、接入方等等一系列调用方</li>
<li>LVS负载均衡</li>
<li>Nginx反向代理</li>
<li>APIGateway
<ul>
<li>流控，控制流量，针对同一个ip在指定的时间段内访问次数做限制</li>
<li>验签解密，校验参数、验证签名信息、将加密的信息解密</li>
<li>接口验证，验证接口是否存在、接口信息是否是当前调用者的接口</li>
<li>接口权限验证，ip黑名单校验、调用的ip是否在白名单内</li>
<li>业务参数验证，校验业务接口参数是否正确</li>
<li>调用业务接口，可以使用dubbo泛化调用</li>
<li>熔断降级，业务方接口不可用的时候或者业务方处理速度变慢，考虑进行熔断降级</li>
<li>加密返回，将调用结果封装、加密、返回</li>
</ul>
</li>
<li>注册中心，dubbo服务注册到注册中心zookeeper</li>
<li>业务服务，各个业务提供的dubbo服务，服务注册到注册中心</li>
<li>存储
<ul>
<li>本地缓存</li>
<li>分布式缓存</li>
<li>MySQL</li>
</ul>
</li>
</ul>
<h1 id="数据库设计">数据库设计</h1>
<ul>
<li>agw_api，接口信息</li>
<li>agw_api_param，接口对应的参数信息</li>
<li>agw_sys，接口所属业务系统</li>
<li>agw_out，外部调用方</li>
<li>agw_out_api，外部调用方拥有的api</li>
<li>agw_out_ip，外部调用方的白名单配置</li>
<li>agw_black_ip，黑名单ip</li>
</ul>
<p>使用draw io画的图，这里是源文件：<a href="/APIGateway%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/APIGateway%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1.drawio">APIGateway数据库设计</a></p>
<p>
<figure>
  <img src="/APIGateway%e8%ae%be%e8%ae%a1%e6%96%87%e6%a1%a3/APIGateway%e6%95%b0%e6%8d%ae%e5%ba%93%e8%ae%be%e8%ae%a1.png" alt="APIGateway数据库设计" />
</figure>


</p>
<h2 id="agw_api">agw_api</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>是否为空</th>
<th>索引</th>
<th>默认值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint(20)</td>
<td>N</td>
<td>PRIMARY</td>
<td></td>
<td>主键ID</td>
</tr>
<tr>
<td>created_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>modified_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>修改时间</td>
</tr>
<tr>
<td>version</td>
<td>smallint(6)</td>
<td>N</td>
<td></td>
<td></td>
<td>版本号</td>
</tr>
<tr>
<td>code</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>api唯一标识</td>
</tr>
<tr>
<td>name</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>api接口名</td>
</tr>
<tr>
<td>method</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>api方法名</td>
</tr>
<tr>
<td>alias</td>
<td>varchar()</td>
<td>Y</td>
<td></td>
<td></td>
<td>api方法别名</td>
</tr>
<tr>
<td>sys_id</td>
<td>bigint(20)</td>
<td>N</td>
<td></td>
<td></td>
<td>所属业务系统id</td>
</tr>
<tr>
<td>timeout</td>
<td>int(6)</td>
<td>N</td>
<td></td>
<td>1000</td>
<td>超时时间，毫秒</td>
</tr>
</tbody>
</table>
<h2 id="agw_api_param">agw_api_param</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>是否为空</th>
<th>索引</th>
<th>默认值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint(20)</td>
<td>N</td>
<td>PRIMARY</td>
<td></td>
<td>主键ID</td>
</tr>
<tr>
<td>created_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>modified_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>修改时间</td>
</tr>
<tr>
<td>version</td>
<td>smallint(6)</td>
<td>N</td>
<td></td>
<td></td>
<td>版本号</td>
</tr>
<tr>
<td>api_id</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>api id</td>
</tr>
<tr>
<td>name</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>参数名</td>
</tr>
<tr>
<td>type</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>参数类型</td>
</tr>
<tr>
<td>sequence</td>
<td>smallint(6)</td>
<td>N</td>
<td></td>
<td></td>
<td>参数顺序</td>
</tr>
</tbody>
</table>
<h2 id="agw_sys">agw_sys</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>是否为空</th>
<th>索引</th>
<th>默认值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint(20)</td>
<td>N</td>
<td>PRIMARY</td>
<td></td>
<td>主键ID</td>
</tr>
<tr>
<td>created_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>modified_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>修改时间</td>
</tr>
<tr>
<td>version</td>
<td>smallint(6)</td>
<td>N</td>
<td></td>
<td></td>
<td>版本号</td>
</tr>
<tr>
<td>name</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>业务系统名</td>
</tr>
<tr>
<td>desc</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>业务系统描述</td>
</tr>
</tbody>
</table>
<h2 id="agw_out">agw_out</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>是否为空</th>
<th>索引</th>
<th>默认值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint(20)</td>
<td>N</td>
<td>PRIMARY</td>
<td></td>
<td>主键ID</td>
</tr>
<tr>
<td>created_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>modified_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>修改时间</td>
</tr>
<tr>
<td>version</td>
<td>smallint(6)</td>
<td>N</td>
<td></td>
<td></td>
<td>版本号</td>
</tr>
<tr>
<td>name</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>外部系统名</td>
</tr>
<tr>
<td>desc</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>外部系统描述</td>
</tr>
<tr>
<td>code</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>外部系统唯一标识</td>
</tr>
<tr>
<td>ip_control</td>
<td>tinyint(4)</td>
<td>Y</td>
<td></td>
<td>0</td>
<td>是否白名单控制 0-否 1-是</td>
</tr>
</tbody>
</table>
<h2 id="agw_out_api">agw_out_api</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>是否为空</th>
<th>索引</th>
<th>默认值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint(20)</td>
<td>N</td>
<td>PRIMARY</td>
<td></td>
<td>主键ID</td>
</tr>
<tr>
<td>created_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>modified_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>修改时间</td>
</tr>
<tr>
<td>version</td>
<td>smallint(6)</td>
<td>N</td>
<td></td>
<td></td>
<td>版本号</td>
</tr>
<tr>
<td>out_id</td>
<td>bigint(20)</td>
<td>N</td>
<td></td>
<td></td>
<td>外部系统id</td>
</tr>
<tr>
<td>api_id</td>
<td>bigint(20)</td>
<td>N</td>
<td></td>
<td></td>
<td>api id</td>
</tr>
</tbody>
</table>
<h2 id="agw_out_ip">agw_out_ip</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>是否为空</th>
<th>索引</th>
<th>默认值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint(20)</td>
<td>N</td>
<td>PRIMARY</td>
<td></td>
<td>主键ID</td>
</tr>
<tr>
<td>created_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>modified_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>修改时间</td>
</tr>
<tr>
<td>version</td>
<td>smallint(6)</td>
<td>N</td>
<td></td>
<td></td>
<td>版本号</td>
</tr>
<tr>
<td>out_id</td>
<td>bigint(20)</td>
<td>N</td>
<td></td>
<td></td>
<td>外部系统id</td>
</tr>
<tr>
<td>ip</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>外部系统白名单</td>
</tr>
</tbody>
</table>
<h2 id="agw_black_ip">agw_black_ip</h2>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>是否为空</th>
<th>索引</th>
<th>默认值</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint(20)</td>
<td>N</td>
<td>PRIMARY</td>
<td></td>
<td>主键ID</td>
</tr>
<tr>
<td>created_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>modified_time</td>
<td>datetime</td>
<td>N</td>
<td></td>
<td></td>
<td>修改时间</td>
</tr>
<tr>
<td>version</td>
<td>smallint(6)</td>
<td>N</td>
<td></td>
<td></td>
<td>版本号</td>
</tr>
<tr>
<td>out_id</td>
<td>bigint(20)</td>
<td>Y</td>
<td></td>
<td></td>
<td>外部系统id</td>
</tr>
<tr>
<td>ip</td>
<td>varchar(255)</td>
<td>N</td>
<td></td>
<td></td>
<td>黑名单ip</td>
</tr>
</tbody>
</table>
<p>源码：<a href="https://github.com/dachengxi/APIGateway">https://github.com/dachengxi/APIGateway</a></p>
			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/2020/11/02/mybatis%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E4%BB%8B%E7%BB%8D/">MyBatis启动过程介绍</a></li>
				
				<li><a href="/2020/10/26/springboot%E4%B8%AD%E6%89%A9%E5%B1%95%E7%82%B9%E6%B1%87%E6%80%BB/">SpringBoot中扩展点汇总</a></li>
				
				<li><a href="/2020/08/26/spring%E4%B8%AD%E5%AF%B9groovy%E6%94%AF%E6%8C%81%E7%9A%84%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">Spring中对Groovy支持的源码分析</a></li>
				
				<li><a href="/2020/08/25/spring%E4%B8%AD%E4%BD%BF%E7%94%A8groovy%E7%9A%84%E7%A4%BA%E4%BE%8B/">Spring中使用Groovy的示例</a></li>
				
				<li><a href="/2020/05/05/spring%E4%B8%ADplaceholder%E7%9A%84%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B/">Spring中Placeholder的解析过程</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2021 <a href="http://cxis.me/"><b>cxis</b></a>.
	<a href="https://gohugo.io/"><b>Hugo</b></a>.
	<a href="https://github.com/colorchestra/smol"><b>Smol</b></a>.
	<a href="https://github.com/dachengxi"><b>Github</b></a>.
	</p>
</footer>

</body>
</html>
