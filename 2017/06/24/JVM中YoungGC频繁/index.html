<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dachengxi.github.com","root":"/","scheme":"Mist","version":"7.7.2","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="分析一下YGC频繁的原因。">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM中YoungGC频繁">
<meta property="og:url" content="http://dachengxi.github.com/2017/06/24/JVM%E4%B8%ADYoungGC%E9%A2%91%E7%B9%81/index.html">
<meta property="og:site_name" content="大程熙">
<meta property="og:description" content="分析一下YGC频繁的原因。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2017-06-24T15:47:36.000Z">
<meta property="article:modified_time" content="2020-04-17T15:47:04.910Z">
<meta property="article:author" content="dachengxi">
<meta property="article:tag" content="JVM">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://dachengxi.github.com/2017/06/24/JVM%E4%B8%ADYoungGC%E9%A2%91%E7%B9%81/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>JVM中YoungGC频繁 | 大程熙</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">大程熙</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">小角落</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>列表</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-book">

    <a href="/book/" rel="section"><i class="fa fa-fw fa-question-circle"></i>读书</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://dachengxi.github.com/2017/06/24/JVM%E4%B8%ADYoungGC%E9%A2%91%E7%B9%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="dachengxi">
      <meta itemprop="description" content="一个小学生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大程熙">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JVM中YoungGC频繁
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-24 23:47:36 23:47:36" itemprop="dateCreated datePublished" datetime="2017-06-24T23:47:36+08:00">2017-06-24 23:47:36</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index"><span itemprop="name">JVM</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2017/06/24/JVM%E4%B8%ADYoungGC%E9%A2%91%E7%B9%81/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/06/24/JVM中YoungGC频繁/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>分析一下YGC频繁的原因。</p>
<a id="more"></a>

<h1 id="GC-log分析"><a href="#GC-log分析" class="headerlink" title="GC log分析"></a>GC log分析</h1><h2 id="log中打印的参数"><a href="#log中打印的参数" class="headerlink" title="log中打印的参数"></a>log中打印的参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Java HotSpot(TM) 64-Bit Server VM (25.172-b11) for linux-amd64 JRE (1.8.0_172-b11), built on Mar 28 2018 21:44:09 by &quot;java_re&quot; with gcc 4.3.0 2008042</span><br><span class="line">8 (Red Hat 4.3.0-8)</span><br><span class="line">Memory: 4k page, physical 8028236k(5004928k free), swap 4096572k(4096572k free)</span><br><span class="line">CommandLine flags: -XX:CMSInitiatingOccupancyFraction&#x3D;70 -XX:+CMSScavengeBeforeRemark -XX:CompressedClassSpaceSize&#x3D;528482304 -XX:+DisableExplicitGC -</span><br><span class="line">XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath&#x3D;&#x2F;home&#x2F;admin&#x2F;service_heap_dump_20190409134805.hprof -XX:InitialHeapSize&#x3D;4294967296 -XX:MaxHeapSize&#x3D;429</span><br><span class="line">4967296 -XX:MaxMetaspaceSize&#x3D;536870912 -XX:MaxNewSize&#x3D;2147483648 -XX:NewSize&#x3D;2147483648 -XX:OldPLABSize&#x3D;16 -XX:-OmitStackTraceInFastThrow -XX:+PrintG</span><br><span class="line">C -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+ScavengeBeforeFullGC -XX:SurvivorRatio&#x3D;8 -XX:+UseCompressedClassPointers -XX</span><br><span class="line">:+UseCompressedOops -XX:+UseConcMarkSweepGC -XX:+UseParNewGC</span><br></pre></td></tr></table></figure>

<ul>
<li>Memory: 4k page</li>
<li>physical 8028236k(5004928k free)，物理内存，7.6G（4.77G空闲）</li>
<li>swap 4096572k(4096572k free)，交换空间，4G（4G空闲）</li>
<li>-XX:CMSInitiatingOccupancyFraction=70，CMS垃圾收集器，当老年代达到指定阈值时，触发CMS垃圾回收，这里是70%</li>
<li>-XX:+CMSScavengeBeforeRemark，CMS在remark之前进行一次YGC，由于新生代存在引用老年代对象的情况，因此CMS remark阶段会将新生代作为老年代的GC ROOTS进行扫描，防止回收了不该回收的对象。而配置CMSScavengeBeforeRemark参数，在CMS GC的remark阶段开始前先进行一次YGC，有利于减少新生代对老年代的无效引用，降低remark阶段的时间开销。</li>
<li>-XX:CompressedClassSpaceSize=528482304，设置Klass Metaspace的大小，500M</li>
<li>-XX:+DisableExplicitGC，禁止代码中显示调用GC</li>
<li>-XX:+HeapDumpOnOutOfMemoryError，当JVM发生OOM时，自动生成DUMP文件</li>
<li>-XX:HeapDumpPath=/home/admin/service_heap_dump_20190409134805.hprof，生成DUMP文件的路径</li>
<li>-XX:InitialHeapSize=4294967296，也就是-Xms指定的参数，初始堆内存大小，4G</li>
<li>-XX:MaxHeapSize=4294967296，也就是-Xmx指定的参数，最大堆内存大小，4G</li>
<li>-XX:MaxMetaspaceSize=536870912，Metaspace大小，512M</li>
<li>-XX:MaxNewSize=2147483648，新生代可被分配的内存的最大上限，2G</li>
<li>-XX:NewSize=2147483648，新生代初始化内存的大小，2G（-Xmn可同时对XX:NewSize和XX:MaxNewSize参数设置）</li>
<li>-XX:OldPLABSize=16，老年代空间 PLAB 大小</li>
<li>-XX:-OmitStackTraceInFastThrow，禁用Fast Throw优化</li>
<li>-XX:+PrintGC，打印GC日志</li>
<li>-XX:+PrintGCDateStamps，输出GC的时间戳</li>
<li>-XX:+PrintGCDetails，打印GC的详细信息</li>
<li>-XX:+PrintGCTimeStamps，输出GC时间戳</li>
<li>-XX:+ScavengeBeforeFullGC，Full GC前执行一次YGC</li>
<li>-XX:SurvivorRatio=8，Eden和两个Survivor的比例：8:1:1</li>
<li>-XX:+UseCompressedClassPointers，压缩类指针</li>
<li>-XX:+UseCompressedOops，压缩对象指针，oops指的是普通对象指针(ordinary object pointers)，Java堆中对象指针会被压缩成32位</li>
<li>-XX:+UseConcMarkSweepGC，老年代收集器为CMS</li>
<li>-XX:+UseParNewGC，新生代收集器为ParNew</li>
</ul>
<h2 id="实际启动参数"><a href="#实际启动参数" class="headerlink" title="实际启动参数"></a>实际启动参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-server -Xms4g -Xmx4g -Xmn2g -XX:MaxMetaspaceSize&#x3D;512m -XX:SurvivorRatio&#x3D;8 -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction&#x3D;70 -XX:+ScavengeBeforeFullGC -XX:+CMSScavengeBeforeRemark -XX:+DisableExplicitGC -XX:-OmitStackTraceInFastThrow -XX:+PrintGCDateStamps -verbose:gc -XX:+PrintGCDetails -Xloggc:$&#123;HOME&#125;&#x2F;service_gc_&#96;date +%Y%m%d%H%M%S&#96;.log -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath&#x3D;$&#123;HOME&#125;&#x2F;service_heap_dump_&#96;date +%Y%m%d%H%M%S&#96;.hprof</span><br></pre></td></tr></table></figure>

<ul>
<li>-Xms4g，初始堆大小，4G</li>
<li>-Xmx4g，最大堆大小，4G</li>
<li>-Xmn2g，新生代初始内存和最大内存都是2G</li>
</ul>
<p>Eden=1.6g，Suvivor0=0.2g，Suvivor1=0.2g</p>
<h2 id="GC-log"><a href="#GC-log" class="headerlink" title="GC log"></a>GC log</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">2019-04-10T20:04:51.945+0800: 109006.832: [GC (GCLocker Initiated GC) 2019-04-10T20:04:51.945+0800: 109006.832: [ParNew: 1823929K-&gt;209664K(1887488K),</span><br><span class="line"> 0.1568521 secs] 2587624K-&gt;1013834K(3984640K), 0.1572354 secs] [Times: user&#x3D;0.58 sys&#x3D;0.00, real&#x3D;0.16 secs] </span><br><span class="line">2019-04-10T20:04:53.556+0800: 109008.442: [GC (Allocation Failure) 2019-04-10T20:04:53.556+0800: 109008.442: [ParNew: 1887488K-&gt;188658K(1887488K), 0.</span><br><span class="line">0834678 secs] 2691658K-&gt;1039814K(3984640K), 0.0837781 secs] [Times: user&#x3D;0.33 sys&#x3D;0.00, real&#x3D;0.08 secs] </span><br><span class="line">2019-04-10T20:04:54.928+0800: 109009.815: [GC (Allocation Failure) 2019-04-10T20:04:54.928+0800: 109009.815: [ParNew: 1866482K-&gt;147763K(1887488K), 0.</span><br><span class="line">0521302 secs] 2717638K-&gt;999285K(3984640K), 0.0524123 secs] [Times: user&#x3D;0.20 sys&#x3D;0.00, real&#x3D;0.05 secs] </span><br><span class="line">2019-04-10T20:04:56.314+0800: 109011.200: [GC (Allocation Failure) 2019-04-10T20:04:56.314+0800: 109011.201: [ParNew: 1825587K-&gt;164545K(1887488K), 0.</span><br><span class="line">1519752 secs] 2677109K-&gt;1084741K(3984640K), 0.1522695 secs] [Times: user&#x3D;0.56 sys&#x3D;0.00, real&#x3D;0.15 secs] </span><br><span class="line">2019-04-10T20:04:57.954+0800: 109012.841: [GC (Allocation Failure) 2019-04-10T20:04:57.954+0800: 109012.841: [ParNew: 1842369K-&gt;194192K(1887488K), 0.</span><br><span class="line">1914321 secs] 2762565K-&gt;1234446K(3984640K), 0.1916991 secs] [Times: user&#x3D;0.70 sys&#x3D;0.00, real&#x3D;0.19 secs] </span><br><span class="line">2019-04-10T20:04:59.497+0800: 109014.384: [GC (Allocation Failure) 2019-04-10T20:04:59.497+0800: 109014.384: [ParNew: 1872016K-&gt;160741K(1887488K), 0.</span><br><span class="line">0486877 secs] 2912270K-&gt;1201078K(3984640K), 0.0489626 secs] [Times: user&#x3D;0.19 sys&#x3D;0.00, real&#x3D;0.05 secs] </span><br><span class="line">2019-04-10T20:05:00.812+0800: 109015.699: [GC (Allocation Failure) 2019-04-10T20:05:00.813+0800: 109015.699: [ParNew: 1835736K-&gt;151823K(1887488K), 0.</span><br><span class="line">1376864 secs] 2876073K-&gt;1255445K(3984640K), 0.1380070 secs] [Times: user&#x3D;0.51 sys&#x3D;0.00, real&#x3D;0.14 secs] </span><br><span class="line">2019-04-10T20:05:02.554+0800: 109017.440: [GC (Allocation Failure) 2019-04-10T20:05:02.554+0800: 109017.440: [ParNew: 1829647K-&gt;171511K(1887488K), 0.</span><br><span class="line">1798695 secs] 2933269K-&gt;1387182K(3984640K), 0.1801425 secs] [Times: user&#x3D;0.67 sys&#x3D;0.00, real&#x3D;0.18 secs] </span><br><span class="line">2019-04-10T20:05:04.059+0800: 109018.946: [GC (Allocation Failure) 2019-04-10T20:05:04.059+0800: 109018.946: [ParNew: 1849335K-&gt;167007K(1887488K), 0.</span><br><span class="line">0483309 secs] 3065006K-&gt;1383074K(3984640K), 0.0486151 secs] [Times: user&#x3D;0.16 sys&#x3D;0.00, real&#x3D;0.05 secs] </span><br><span class="line">2019-04-10T20:05:05.628+0800: 109020.515: [GC (Allocation Failure) 2019-04-10T20:05:05.628+0800: 109020.515: [ParNew: 1844831K-&gt;209664K(1887488K), 0.</span><br><span class="line">1480378 secs] 3060898K-&gt;1457657K(3984640K), 0.1483184 secs] [Times: user&#x3D;0.57 sys&#x3D;0.00, real&#x3D;0.15 secs] </span><br><span class="line">2019-04-10T20:05:07.079+0800: 109021.966: [GC (Allocation Failure) 2019-04-10T20:05:07.079+0800: 109021.966: [ParNew: 1887488K-&gt;170162K(1887488K), 0.</span><br><span class="line">0579737 secs] 3135481K-&gt;1418544K(3984640K), 0.0582560 secs] [Times: user&#x3D;0.23 sys&#x3D;0.00, real&#x3D;0.06 secs] </span><br><span class="line">2019-04-10T20:05:08.604+0800: 109023.491: [GC (Allocation Failure) 2019-04-10T20:05:08.604+0800: 109023.491: [ParNew: 1847986K-&gt;209664K(1887488K), 0.</span><br><span class="line">1702964 secs] 3096368K-&gt;1587027K(3984640K), 0.1705767 secs] [Times: user&#x3D;0.63 sys&#x3D;0.00, real&#x3D;0.18 secs] </span><br><span class="line">2019-04-10T20:05:10.186+0800: 109025.073: [GC (Allocation Failure) 2019-04-10T20:05:10.186+0800: 109025.073: [ParNew: 1887488K-&gt;200295K(1887488K), 0.</span><br><span class="line">1819795 secs] 3264851K-&gt;1676149K(3984640K), 0.1822649 secs] [Times: user&#x3D;0.67 sys&#x3D;0.00, real&#x3D;0.18 secs] </span><br><span class="line">2019-04-10T20:05:10.372+0800: 109025.259: [GC (CMS Initial Mark) [1 CMS-initial-mark: 1475854K(2097152K)] 1694195K(3984640K), 0.0302480 secs] [Times:</span><br><span class="line"> user&#x3D;0.07 sys&#x3D;0.00, real&#x3D;0.03 secs] </span><br><span class="line">2019-04-10T20:05:10.403+0800: 109025.289: [CMS-concurrent-mark-start]</span><br><span class="line">2019-04-10T20:05:10.565+0800: 109025.452: [CMS-concurrent-mark: 0.162&#x2F;0.162 secs] [Times: user&#x3D;0.36 sys&#x3D;0.00, real&#x3D;0.17 secs] </span><br><span class="line">2019-04-10T20:05:10.565+0800: 109025.452: [CMS-concurrent-preclean-start]</span><br><span class="line">2019-04-10T20:05:10.571+0800: 109025.458: [CMS-concurrent-preclean: 0.006&#x2F;0.006 secs] [Times: user&#x3D;0.01 sys&#x3D;0.00, real&#x3D;0.00 secs] </span><br><span class="line">2019-04-10T20:05:10.571+0800: 109025.458: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line">2019-04-10T20:05:11.842+0800: 109026.729: [GC (GCLocker Initiated GC) 2019-04-10T20:05:11.842+0800: 109026.729: [ParNew: 1849355K-&gt;187949K(1887488K),</span><br><span class="line"> 0.1785371 secs] 3357977K-&gt;1840092K(3984640K), 0.1789082 secs] [Times: user&#x3D;0.65 sys&#x3D;0.00, real&#x3D;0.18 secs] </span><br><span class="line">2019-04-10T20:05:13.012+0800: 109027.899: [CMS-concurrent-abortable-preclean: 2.251&#x2F;2.441 secs] [Times: user&#x3D;6.67 sys&#x3D;0.00, real&#x3D;2.44 secs] </span><br><span class="line">2019-04-10T20:05:13.013+0800: 109027.900: [GC (CMS Final Remark) [YG occupancy: 1220076 K (1887488 K)]2019-04-10T20:05:13.013+0800: 109027.900: [GC (</span><br><span class="line">CMS Final Remark) 2019-04-10T20:05:13.014+0800: 109027.900: [ParNew: 1220076K-&gt;154513K(1887488K), 0.1657934 secs] 2872219K-&gt;1924261K(3984640K), 0.166</span><br><span class="line">0497 secs] [Times: user&#x3D;0.60 sys&#x3D;0.00, real&#x3D;0.17 secs] </span><br><span class="line">2019-04-10T20:05:13.180+0800: 109028.066: [Rescan (parallel) , 0.0454351 secs]2019-04-10T20:05:13.225+0800: 109028.112: [weak refs processing, 0.0001</span><br><span class="line">084 secs]2019-04-10T20:05:13.225+0800: 109028.112: [class unloading, 0.0520415 secs]2019-04-10T20:05:13.277+0800: 109028.164: [scrub symbol table, 0.</span><br><span class="line">0156959 secs]2019-04-10T20:05:13.293+0800: 109028.180: [scrub string table, 0.0014593 secs][1 CMS-remark: 1769747K(2097152K)] 1924261K(3984640K), 0.3</span><br><span class="line">026953 secs] [Times: user&#x3D;0.87 sys&#x3D;0.00, real&#x3D;0.31 secs] </span><br><span class="line">2019-04-10T20:05:13.316+0800: 109028.203: [CMS-concurrent-sweep-start]</span><br><span class="line">2019-04-10T20:05:14.813+0800: 109029.700: [GC (Allocation Failure) 2019-04-10T20:05:14.813+0800: 109029.700: [ParNew: 1832337K-&gt;209664K(1887488K), 0.</span><br><span class="line">1690814 secs] 2401415K-&gt;829430K(3984640K), 0.1694105 secs] [Times: user&#x3D;0.64 sys&#x3D;0.00, real&#x3D;0.17 secs] </span><br><span class="line">2019-04-10T20:05:15.076+0800: 109029.963: [CMS-concurrent-sweep: 1.586&#x2F;1.760 secs] [Times: user&#x3D;5.11 sys&#x3D;0.00, real&#x3D;1.76 secs] </span><br><span class="line">2019-04-10T20:05:15.076+0800: 109029.963: [CMS-concurrent-reset-start]</span><br><span class="line">2019-04-10T20:05:15.080+0800: 109029.967: [CMS-concurrent-reset: 0.004&#x2F;0.004 secs] [Times: user&#x3D;0.01 sys&#x3D;0.00, real&#x3D;0.00 secs] </span><br><span class="line">2019-04-10T20:05:16.566+0800: 109031.452: [GC (Allocation Failure) 2019-04-10T20:05:16.566+0800: 109031.452: [ParNew: 1887488K-&gt;209664K(1887488K), 0.</span><br><span class="line">0852347 secs] 2376299K-&gt;751020K(3984640K), 0.0855516 secs] [Times: user&#x3D;0.34 sys&#x3D;0.00, real&#x3D;0.08 secs] </span><br><span class="line">2019-04-10T20:05:16.655+0800: 109031.541: [GC (GCLocker Initiated GC) 2019-04-10T20:05:16.655+0800: 109031.542: [ParNew: 226066K-&gt;69094K(1887488K), 0</span><br><span class="line">.1444585 secs] 767423K-&gt;723085K(3984640K), 0.1446827 secs] [Times: user&#x3D;0.42 sys&#x3D;0.00, real&#x3D;0.15 secs] </span><br><span class="line">2019-04-10T20:05:18.192+0800: 109033.079: [GC (Allocation Failure) 2019-04-10T20:05:18.193+0800: 109033.079: [ParNew: 1746918K-&gt;121493K(1887488K), 0.</span><br><span class="line">0520770 secs] 2400909K-&gt;775483K(3984640K), 0.0523791 secs] [Times: user&#x3D;0.21 sys&#x3D;0.00, real&#x3D;0.05 secs] </span><br><span class="line">2019-04-10T20:05:19.766+0800: 109034.653: [GC (Allocation Failure) 2019-04-10T20:05:19.766+0800: 109034.653: [ParNew: 1799317K-&gt;172147K(1887488K), 0.</span><br><span class="line">2003248 secs] 2453307K-&gt;940006K(3984640K), 0.2009707 secs] [Times: user&#x3D;0.71 sys&#x3D;0.00, real&#x3D;0.20 secs] </span><br><span class="line">2019-04-10T20:05:21.337+0800: 109036.224: [GC (Allocation Failure) 2019-04-10T20:05:21.337+0800: 109036.224: [ParNew: 1850818K-&gt;173032K(1887488K), 0.</span><br><span class="line">2056822 secs] 2618676K-&gt;1080561K(3984640K), 0.2060002 secs] [Times: user&#x3D;0.72 sys&#x3D;0.00, real&#x3D;0.20 secs] </span><br><span class="line">2019-04-10T20:05:21.546+0800: 109036.433: [GC (GCLocker Initiated GC) 2019-04-10T20:05:21.547+0800: 109036.433: [ParNew: 190483K-&gt;57139K(1887488K), 0</span><br><span class="line">.0843375 secs] 1098011K-&gt;1080787K(3984640K), 0.0845775 secs] [Times: user&#x3D;0.29 sys&#x3D;0.00, real&#x3D;0.08 secs] </span><br><span class="line">2019-04-10T20:05:23.036+0800: 109037.923: [GC (Allocation Failure) 2019-04-10T20:05:23.036+0800: 109037.923: [ParNew: 1734963K-&gt;142250K(1887488K), 0.</span><br><span class="line">0654108 secs] 2758611K-&gt;1165898K(3984640K), 0.0657093 secs] [Times: user&#x3D;0.25 sys&#x3D;0.00, real&#x3D;0.07 secs] </span><br><span class="line">2019-04-10T20:05:24.549+0800: 109039.435: [GC (GCLocker Initiated GC) 2019-04-10T20:05:24.549+0800: 109039.436: [ParNew: 1820074K-&gt;168253K(1887488K),</span><br><span class="line"> 0.1858657 secs] 2843722K-&gt;1321273K(3984640K), 0.1861676 secs] [Times: user&#x3D;0.68 sys&#x3D;0.00, real&#x3D;0.18 secs] </span><br><span class="line">2019-04-10T20:05:26.085+0800: 109040.972: [GC (Allocation Failure) 2019-04-10T20:05:26.085+0800: 109040.972: [ParNew: 1846077K-&gt;154005K(1887488K), 0.</span><br><span class="line">0462496 secs] 2999097K-&gt;1307234K(3984640K), 0.0465630 secs] [Times: user&#x3D;0.18 sys&#x3D;0.00, real&#x3D;0.05 secs] </span><br><span class="line">2019-04-10T20:05:27.460+0800: 109042.347: [GC (GCLocker Initiated GC) 2019-04-10T20:05:27.460+0800: 109042.347: [ParNew: 1857495K-&gt;209664K(1887488K),</span><br><span class="line"> 0.0913403 secs] 3010724K-&gt;1371383K(3984640K), 0.0916332 secs] [Times: user&#x3D;0.36 sys&#x3D;0.00, real&#x3D;0.09 secs] </span><br><span class="line">2019-04-10T20:05:28.944+0800: 109043.831: [GC (GCLocker Initiated GC) 2019-04-10T20:05:28.944+0800: 109043.831: [ParNew: 1887488K-&gt;204384K(1887488K),</span><br><span class="line"> 0.1025569 secs] 3049209K-&gt;1406621K(3984640K), 0.1028616 secs] [Times: user&#x3D;0.39 sys&#x3D;0.00, real&#x3D;0.11 secs] </span><br><span class="line">2019-04-10T20:05:30.291+0800: 109045.178: [GC (Allocation Failure) 2019-04-10T20:05:30.291+0800: 109045.178: [ParNew: 1882208K-&gt;171428K(1887488K), 0.</span><br><span class="line">0444964 secs] 3084445K-&gt;1373752K(3984640K), 0.0448216 secs] [Times: user&#x3D;0.14 sys&#x3D;0.00, real&#x3D;0.04 secs] </span><br><span class="line">2019-04-10T20:05:31.769+0800: 109046.656: [GC (Allocation Failure) 2019-04-10T20:05:31.769+0800: 109046.656: [ParNew: 1840540K-&gt;209664K(1887488K), 0.</span><br><span class="line">1070460 secs] 3042865K-&gt;1414779K(3984640K), 0.1073485 secs] [Times: user&#x3D;0.41 sys&#x3D;0.00, real&#x3D;0.10 secs] </span><br><span class="line">2019-04-10T20:05:33.293+0800: 109048.180: [GC (Allocation Failure) 2019-04-10T20:05:33.293+0800: 109048.180: [ParNew: 1887488K-&gt;174620K(1887488K), 0.</span><br><span class="line">1014037 secs] 3092603K-&gt;1426287K(3984640K), 0.1017165 secs] [Times: user&#x3D;0.39 sys&#x3D;0.00, real&#x3D;0.10 secs] </span><br><span class="line">2019-04-10T20:05:34.713+0800: 109049.600: [GC (Allocation Failure) 2019-04-10T20:05:34.713+0800: 109049.600: [ParNew: 1852444K-&gt;149718K(1887488K), 0.</span><br><span class="line">0388156 secs] 3104111K-&gt;1401511K(3984640K), 0.0391062 secs] [Times: user&#x3D;0.13 sys&#x3D;0.00, real&#x3D;0.04 secs] </span><br><span class="line">2019-04-10T20:05:36.300+0800: 109051.187: [GC (Allocation Failure) 2019-04-10T20:05:36.300+0800: 109051.187: [ParNew: 1827542K-&gt;209664K(1887488K), 0.</span><br><span class="line">1370734 secs] 3079335K-&gt;1482894K(3984640K), 0.1373627 secs] [Times: user&#x3D;0.52 sys&#x3D;0.00, real&#x3D;0.13 secs] </span><br><span class="line">2019-04-10T20:05:37.822+0800: 109052.709: [GC (Allocation Failure) 2019-04-10T20:05:37.823+0800: 109052.709: [ParNew: 1887488K-&gt;168568K(1887488K), 0.</span><br><span class="line">0630131 secs] 3160718K-&gt;1442889K(3984640K), 0.0633086 secs] [Times: user&#x3D;0.25 sys&#x3D;0.00, real&#x3D;0.06 secs] </span><br><span class="line">2019-04-10T20:05:39.229+0800: 109054.116: [GC (GCLocker Initiated GC) 2019-04-10T20:05:39.229+0800: 109054.116: [ParNew: 1862776K-&gt;199264K(1887488K),</span><br><span class="line"> 0.1551475 secs] 3137097K-&gt;1600406K(3984640K), 0.1554344 secs] [Times: user&#x3D;0.57 sys&#x3D;0.00, real&#x3D;0.15 secs] </span><br><span class="line">2019-04-10T20:05:40.850+0800: 109055.736: [GC (Allocation Failure) 2019-04-10T20:05:40.850+0800: 109055.737: [ParNew: 1877088K-&gt;165034K(1887488K), 0.</span><br><span class="line">1900999 secs] 3278230K-&gt;1682137K(3984640K), 0.1904167 secs] [Times: user&#x3D;0.69 sys&#x3D;0.00, real&#x3D;0.19 secs] </span><br><span class="line">2019-04-10T20:05:41.041+0800: 109055.928: [GC (CMS Initial Mark) [1 CMS-initial-mark: 1517102K(2097152K)] 1698563K(3984640K), 0.0451473 secs] [Times:</span><br><span class="line"> user&#x3D;0.11 sys&#x3D;0.00, real&#x3D;0.04 secs]</span><br></pre></td></tr></table></figure>
<h2 id="ParNew日志"><a href="#ParNew日志" class="headerlink" title="ParNew日志"></a>ParNew日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2019-04-10T20:04:53.556+0800: 109008.442: [GC (Allocation Failure) 2019-04-10T20:04:53.556+0800: 109008.442: [ParNew: 1887488K-&gt;188658K(1887488K), 0.0834678 secs] 2691658K-&gt;1039814K(3984640K), 0.0837781 secs] [Times: user&#x3D;0.33 sys&#x3D;0.00, real&#x3D;0.08 secs]</span><br></pre></td></tr></table></figure>

<ul>
<li>GC，表示是一次YGC</li>
<li>Allocation Failure，表示失败类型</li>
<li>ParNew，收集器名称，ParNew收集器，多线程，并行，Stop the World</li>
<li>1887488K-&gt;188658K，收集前后新生代情况，1.8G -&gt; 184M</li>
<li>(1887488K)，新生代容量，1.8G</li>
<li>0.0834678 secs，新生代GC花费的时间</li>
<li>2691658K-&gt;1039814K，收集前后整个堆的使用情况，2.5G -&gt; 0.99G</li>
<li>(3984640K)，整个堆的容量，3.8G</li>
<li>0.0837781 secs，GC总时间，ParNew 收集器标记和复制新生代活着的对象所花费的时间（包括和老年代通信的开销、对象晋升到老年代开销、垃圾收集周期结束一些最后的清理对象等的花销）</li>
<li>Times: user=0.33 sys=0.00, real=0.08 secs<ul>
<li>user，GC线程在垃圾收集期间使用的CPU总时间</li>
<li>sys，系统调用或者等待系统事件花费的时间</li>
<li>real，应用被暂停的时间，GC 线程是多线程的，导致了 real 小于 (user+sys)，如果是 gc 线程是单线程的话，real 是接近于 (user+sys) 时间</li>
</ul>
</li>
</ul>
<p>收集前新生代大小1887488K-&gt;收集后新生代大小188658K(新生代总大小1887488K)，YGC后新生代大小减少了1698830K；收集前堆大小2691658K-&gt;收集后堆大小1039814K(堆总大小3984640K)，YGC后新生代大小减少了1651844K，晋升到老年代的大小为：1698830K - 1651844K = 46986K</p>
<h2 id="CMS日志"><a href="#CMS日志" class="headerlink" title="CMS日志"></a>CMS日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">2019-04-10T20:05:10.372+0800: 109025.259: [GC (CMS Initial Mark) [1 CMS-initial-mark: 1475854K(2097152K)] 1694195K(3984640K), 0.0302480 secs] [Times:</span><br><span class="line"> user&#x3D;0.07 sys&#x3D;0.00, real&#x3D;0.03 secs] </span><br><span class="line">2019-04-10T20:05:10.403+0800: 109025.289: [CMS-concurrent-mark-start]</span><br><span class="line">2019-04-10T20:05:10.565+0800: 109025.452: [CMS-concurrent-mark: 0.162&#x2F;0.162 secs] [Times: user&#x3D;0.36 sys&#x3D;0.00, real&#x3D;0.17 secs] </span><br><span class="line">2019-04-10T20:05:10.565+0800: 109025.452: [CMS-concurrent-preclean-start]</span><br><span class="line">2019-04-10T20:05:10.571+0800: 109025.458: [CMS-concurrent-preclean: 0.006&#x2F;0.006 secs] [Times: user&#x3D;0.01 sys&#x3D;0.00, real&#x3D;0.00 secs] </span><br><span class="line">2019-04-10T20:05:10.571+0800: 109025.458: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line">2019-04-10T20:05:11.842+0800: 109026.729: [GC (GCLocker Initiated GC) 2019-04-10T20:05:11.842+0800: 109026.729: [ParNew: 1849355K-&gt;187949K(1887488K),</span><br><span class="line"> 0.1785371 secs] 3357977K-&gt;1840092K(3984640K), 0.1789082 secs] [Times: user&#x3D;0.65 sys&#x3D;0.00, real&#x3D;0.18 secs] </span><br><span class="line">2019-04-10T20:05:13.012+0800: 109027.899: [CMS-concurrent-abortable-preclean: 2.251&#x2F;2.441 secs] [Times: user&#x3D;6.67 sys&#x3D;0.00, real&#x3D;2.44 secs] </span><br><span class="line">2019-04-10T20:05:13.013+0800: 109027.900: [GC (CMS Final Remark) [YG occupancy: 1220076 K (1887488 K)]2019-04-10T20:05:13.013+0800: 109027.900: [GC (</span><br><span class="line">CMS Final Remark) 2019-04-10T20:05:13.014+0800: 109027.900: [ParNew: 1220076K-&gt;154513K(1887488K), 0.1657934 secs] 2872219K-&gt;1924261K(3984640K), 0.166</span><br><span class="line">0497 secs] [Times: user&#x3D;0.60 sys&#x3D;0.00, real&#x3D;0.17 secs] </span><br><span class="line">2019-04-10T20:05:13.180+0800: 109028.066: [Rescan (parallel) , 0.0454351 secs]2019-04-10T20:05:13.225+0800: 109028.112: [weak refs processing, 0.0001</span><br><span class="line">084 secs]2019-04-10T20:05:13.225+0800: 109028.112: [class unloading, 0.0520415 secs]2019-04-10T20:05:13.277+0800: 109028.164: [scrub symbol table, 0.</span><br><span class="line">0156959 secs]2019-04-10T20:05:13.293+0800: 109028.180: [scrub string table, 0.0014593 secs][1 CMS-remark: 1769747K(2097152K)] 1924261K(3984640K), 0.3</span><br><span class="line">026953 secs] [Times: user&#x3D;0.87 sys&#x3D;0.00, real&#x3D;0.31 secs] </span><br><span class="line">2019-04-10T20:05:13.316+0800: 109028.203: [CMS-concurrent-sweep-start]</span><br><span class="line">2019-04-10T20:05:14.813+0800: 109029.700: [GC (Allocation Failure) 2019-04-10T20:05:14.813+0800: 109029.700: [ParNew: 1832337K-&gt;209664K(1887488K), 0.</span><br><span class="line">1690814 secs] 2401415K-&gt;829430K(3984640K), 0.1694105 secs] [Times: user&#x3D;0.64 sys&#x3D;0.00, real&#x3D;0.17 secs] </span><br><span class="line">2019-04-10T20:05:15.076+0800: 109029.963: [CMS-concurrent-sweep: 1.586&#x2F;1.760 secs] [Times: user&#x3D;5.11 sys&#x3D;0.00, real&#x3D;1.76 secs] </span><br><span class="line">2019-04-10T20:05:15.076+0800: 109029.963: [CMS-concurrent-reset-start]</span><br><span class="line">2019-04-10T20:05:15.080+0800: 109029.967: [CMS-concurrent-reset: 0.004&#x2F;0.004 secs] [Times: user&#x3D;0.01 sys&#x3D;0.00, real&#x3D;0.00 secs]</span><br></pre></td></tr></table></figure>

<h3 id="初始标记阶段"><a href="#初始标记阶段" class="headerlink" title="初始标记阶段"></a>初始标记阶段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2019-04-10T20:05:10.372+0800: 109025.259: [GC (CMS Initial Mark) [1 CMS-initial-mark: 1475854K(2097152K)] 1694195K(3984640K), 0.0302480 secs] [Times:</span><br><span class="line"> user&#x3D;0.07 sys&#x3D;0.00, real&#x3D;0.03 secs]</span><br></pre></td></tr></table></figure>

<ul>
<li>GC (CMS Initial Mark)，CMS收集器的初始标记阶段</li>
<li>1475854K(2097152K)，老年代占用1475854K（1.4G），老年代容量2097152K（2G）</li>
<li>1694195K(3984640K)，整个堆的占用1694195K（1.6G），整个堆的容量3984640K（3.8G）</li>
<li>0.0302480 secs，本次标记耗时</li>
</ul>
<p>该阶段从垃圾回收的根对象开始，且只扫描直接与根对象直接关联的对象，并做标记，需要Stop The Word，速度很快。</p>
<h3 id="并发标记"><a href="#并发标记" class="headerlink" title="并发标记"></a>并发标记</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2019-04-10T20:05:10.403+0800: 109025.289: [CMS-concurrent-mark-start]</span><br><span class="line">2019-04-10T20:05:10.565+0800: 109025.452: [CMS-concurrent-mark: 0.162&#x2F;0.162 secs] [Times: user&#x3D;0.36 sys&#x3D;0.00, real&#x3D;0.17 secs] </span><br><span class="line">2019-04-10T20:05:10.565+0800: 109025.452: [CMS-concurrent-preclean-start]</span><br><span class="line">2019-04-10T20:05:10.571+0800: 109025.458: [CMS-concurrent-preclean: 0.006&#x2F;0.006 secs] [Times: user&#x3D;0.01 sys&#x3D;0.00, real&#x3D;0.00 secs]</span><br><span class="line">2019-04-10T20:05:10.571+0800: 109025.458: [CMS-concurrent-abortable-preclean-start]</span><br><span class="line">2019-04-10T20:05:11.842+0800: 109026.729: [GC (GCLocker Initiated GC) 2019-04-10T20:05:11.842+0800: 109026.729: [ParNew: 1849355K-&gt;187949K(1887488K),</span><br><span class="line"> 0.1785371 secs] 3357977K-&gt;1840092K(3984640K), 0.1789082 secs] [Times: user&#x3D;0.65 sys&#x3D;0.00, real&#x3D;0.18 secs] </span><br><span class="line">2019-04-10T20:05:13.012+0800: 109027.899: [CMS-concurrent-abortable-preclean: 2.251&#x2F;2.441 secs] [Times: user&#x3D;6.67 sys&#x3D;0.00, real&#x3D;2.44 secs]</span><br></pre></td></tr></table></figure>

<ul>
<li>CMS-concurrent-mark-start，表示并发标记阶段开始，会遍历整个年老代并且标记活着的对象</li>
<li>CMS-concurrent-mark: 0.162/0.162 secs表示该阶段持续的时间和时钟时间，耗时0.162秒，耗时稍长。由于该阶运行的过程中用户线程也在运行，这就可能会发生这样的情况，已经被遍历过的对象的引用被用户线程改变，如果发生了这样的情况，JVM就会标记这个区域为Dirty Card。</li>
<li>CMS-concurrent-preclean-start，预清理开始，该阶段检查并发标记阶段时从新生代晋升的对象，或新分配的对象，或被应用程序线程更新过的对象，（也就是上一个阶段被标记为Dirty Card的对象），帮助减少重新标记阶段的暂停时间。如果在此之后，Eden的占用量&gt;CMSScheduleRemarkEdenSizeThreshold(默认为2M),会启动CMS-concurrent-abortable-preclean，预清理阶段只是一个取样过程，它将新生代按一定间隔进行分块，标记起始位置，以便remark时可以并行的的对块进行trace。不必从开头一点一点进行trace，预清理阶段时，最好发生一次ygc</li>
<li>CMS-concurrent-preclean: 0.006/0.006 secs，预清理耗时</li>
<li>CMS-concurrent-abortable-preclean-start，并发预清理开始，继续预清理，至到Eden区占用量达到CMSScheduleRemarkEdenPenetration(默认50%)，或达到5秒钟。但是如果ygc在这个阶段中没有发生的话，是达不到理想效果的。此时可以指定CMSMaxAbortablePrecleanTime，但是，等待一般都不是什么好的策略，可以采用CMSScavengeBeforeRemark，使remark之前发生一次YGC，从而减少remark阶段暂停的时间。</li>
<li>CMS-concurrent-abortable-preclean: 2.251/2.441 secs，并发预清理耗时</li>
</ul>
<h3 id="重新标记阶段"><a href="#重新标记阶段" class="headerlink" title="重新标记阶段"></a>重新标记阶段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2019-04-10T20:05:13.013+0800: 109027.900: [GC (CMS Final Remark) [YG occupancy: 1220076 K (1887488 K)]2019-04-10T20:05:13.013+0800: 109027.900: [GC (</span><br><span class="line">CMS Final Remark) 2019-04-10T20:05:13.014+0800: 109027.900: [ParNew: 1220076K-&gt;154513K(1887488K), 0.1657934 secs] 2872219K-&gt;1924261K(3984640K), 0.166</span><br><span class="line">0497 secs] [Times: user&#x3D;0.60 sys&#x3D;0.00, real&#x3D;0.17 secs] </span><br><span class="line">2019-04-10T20:05:13.180+0800: 109028.066: [Rescan (parallel) , 0.0454351 secs]2019-04-10T20:05:13.225+0800: 109028.112: [weak refs processing, 0.0001</span><br><span class="line">084 secs]2019-04-10T20:05:13.225+0800: 109028.112: [class unloading, 0.0520415 secs]2019-04-10T20:05:13.277+0800: 109028.164: [scrub symbol table, 0.</span><br><span class="line">0156959 secs]2019-04-10T20:05:13.293+0800: 109028.180: [scrub string table, 0.0014593 secs][1 CMS-remark: 1769747K(2097152K)] 1924261K(3984640K), 0.3</span><br><span class="line">026953 secs] [Times: user&#x3D;0.87 sys&#x3D;0.00, real&#x3D;0.31 secs]</span><br></pre></td></tr></table></figure>

<ul>
<li>[GC (CMS Final Remark)，CMS重新标记阶段，该阶段的任务是完成标记整个年老代的所有的存活对象，尽管先前的pre clean阶段尽量应对处理了并发运行时用户线程改变的对象应用的标记，但是不可能跟上对象改变的速度，只是为final remark阶段尽量减少了负担。会Stop The World。</li>
<li>YG occupancy: 1220076 K (1887488 K)，新生代当前内存占用情况，占用1220076k（1.1G），容量1887488K（1.8G），通常Final Remark阶段要尽量运行在年轻代是足够干净的时候，这样可以消除紧接着的连续的几个STW阶段。</li>
<li>Rescan (parallel) 0.0454351 secs，整个final remark阶段扫描对象的用时总计，该阶段会重新扫描CMS堆中剩余的对象，重新从“根对象”开始扫描，并且也会处理对象关联。本次扫描共耗时0.0454351秒。</li>
<li>weak refs processing, 0.0001084 secs，对弱引用处理的耗时</li>
<li>class unloading, 0.0520415 secs，卸载无用类的耗时</li>
<li>scrub symbol table, 0.0156959 secs，scrub string table, 0.0014593 secs，清理分别包含类级元数据和内部化字符串的符号和字符串表的耗时</li>
<li>1 CMS-remark: 1769747K(2097152K)，经历了上面阶段后老年代使用情况，老年代占用1769747K（1.6g），老年代容量2097152K(2G）</li>
<li>1924261K(3984640K), 0.3026953 secs，表示经历了final remark后整个堆的使用情况和final remark耗时，堆占用1924261K（1.8G），堆容量3984640K（3.8G）</li>
</ul>
<h3 id="并发清除阶段"><a href="#并发清除阶段" class="headerlink" title="并发清除阶段"></a>并发清除阶段</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2019-04-10T20:05:13.316+0800: 109028.203: [CMS-concurrent-sweep-start]</span><br><span class="line">2019-04-10T20:05:14.813+0800: 109029.700: [GC (Allocation Failure) 2019-04-10T20:05:14.813+0800: 109029.700: [ParNew: 1832337K-&gt;209664K(1887488K), 0.</span><br><span class="line">1690814 secs] 2401415K-&gt;829430K(3984640K), 0.1694105 secs] [Times: user&#x3D;0.64 sys&#x3D;0.00, real&#x3D;0.17 secs] </span><br><span class="line">2019-04-10T20:05:15.076+0800: 109029.963: [CMS-concurrent-sweep: 1.586&#x2F;1.760 secs] [Times: user&#x3D;5.11 sys&#x3D;0.00, real&#x3D;1.76 secs] </span><br><span class="line">2019-04-10T20:05:15.076+0800: 109029.963: [CMS-concurrent-reset-start]</span><br><span class="line">2019-04-10T20:05:15.080+0800: 109029.967: [CMS-concurrent-reset: 0.004&#x2F;0.004 secs] [Times: user&#x3D;0.01 sys&#x3D;0.00, real&#x3D;0.00 secs]</span><br></pre></td></tr></table></figure>

<ul>
<li>CMS-concurrent-sweep-start，并发清除阶段开始，清除之前标记阶段没有被标记的无用对象并回收内存</li>
<li>CMS-concurrent-sweep: 1.586/1.760 secs，清除没有标记的无用对象并回收内存的耗时</li>
<li>CMS-concurrent-reset-start，重新设置CMS算法内部数据结构开始</li>
<li>CMS-concurrent-reset: 0.004/0.004 secs，重置CMS内部算法数据结构耗时</li>
</ul>
<h1 id="YGC频繁"><a href="#YGC频繁" class="headerlink" title="YGC频繁"></a>YGC频繁</h1><p>报警提示YGC频繁，日志显示每秒一次YGC，单次耗时50ms - 200ms，一分钟多一次Major GC</p>
<p>参数：</p>
<p>堆大小：4G，新生代大小：2G，Eden：1.6G，Survivor0：200M，Suvivor1:200M</p>
<p>YGC触发原因：</p>
<ul>
<li>Eden区满的时候，会触发YGC</li>
</ul>
<p>YGC频繁的原因：</p>
<ul>
<li>产生了太多的短期对象，导致频繁的YGC</li>
<li>新生代的空间太小</li>
</ul>
<p>这里场景是需要根据一个优惠券查询所有绑定了这个优惠券的商品，如果是商户优惠券或者类目优惠券，一个券将会有上万的商品关系，一次券的操作就会产生大量的对象并且都是一次性的。</p>
<p>调整：</p>
<p>堆大小增加到6G，新生代大小4G，-XX:SurvivorRatio=6，Eden：3.2G，Suvivor0：1.4g，Survivor1：1.4g</p>
<p>程序优化并且调整了参数后，没再发生过YGC频繁报警，Eden增大后并且Suvivor增大后，YGC次数下降，并且由于Suvivor增大，很多短期对象不再晋升到老年代，Major GC次数也减少了。</p>

    </div>

    
    
    
        <div class="reward-container">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="dachengxi 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="dachengxi 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/JVM/" rel="tag"># JVM</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/06/18/JVM%E4%B8%AD%E5%9B%9B%E7%A7%8D%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/" rel="prev" title="JVM四种引用类型">
      <i class="fa fa-chevron-left"></i> JVM四种引用类型
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/06/24/JVM%E4%B8%ADYoungGC%E8%80%97%E6%97%B6%E8%BF%87%E9%AB%98/" rel="next" title="JVM中YoungGC耗时过高">
      JVM中YoungGC耗时过高 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#GC-log分析"><span class="nav-number">1.</span> <span class="nav-text">GC log分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#log中打印的参数"><span class="nav-number">1.1.</span> <span class="nav-text">log中打印的参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#实际启动参数"><span class="nav-number">1.2.</span> <span class="nav-text">实际启动参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GC-log"><span class="nav-number">1.3.</span> <span class="nav-text">GC log</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ParNew日志"><span class="nav-number">1.4.</span> <span class="nav-text">ParNew日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CMS日志"><span class="nav-number">1.5.</span> <span class="nav-text">CMS日志</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#初始标记阶段"><span class="nav-number">1.5.1.</span> <span class="nav-text">初始标记阶段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#并发标记"><span class="nav-number">1.5.2.</span> <span class="nav-text">并发标记</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#重新标记阶段"><span class="nav-number">1.5.3.</span> <span class="nav-text">重新标记阶段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#并发清除阶段"><span class="nav-number">1.5.4.</span> <span class="nav-text">并发清除阶段</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#YGC频繁"><span class="nav-number">2.</span> <span class="nav-text">YGC频繁</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dachengxi"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">dachengxi</p>
  <div class="site-description" itemprop="description">一个小学生</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">180</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">98</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/dachengxi" title="GitHub → https://github.com/dachengxi" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://weibo.com/dachengxi" title="微博 → http://weibo.com/dachengxi" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>微博</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://git.oschina.net/dachengxi" title="码云 → http://git.oschina.net/dachengxi" rel="noopener" target="_blank"><i class="fa fa-fw fa-git"></i>码云</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      友链
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://hexo.io" title="http://hexo.io" rel="noopener" target="_blank">Hexo</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://github.com/iissnan/hexo-theme-next" title="https://github.com/iissnan/hexo-theme-next" rel="noopener" target="_blank">Next Theme</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2014 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dachengxi</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://cxis.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://dachengxi.github.com/2017/06/24/JVM%E4%B8%ADYoungGC%E9%A2%91%E7%B9%81/";
    this.page.identifier = "2017/06/24/JVM中YoungGC频繁/";
    this.page.title = "JVM中YoungGC频繁";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://cxis.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

  <a href="https://github.com/dachengxi" target="_blank" rel="noopener"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>
</body>
</html>
